{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { getPosition } from './get-position';\n\nvar Tracker =\n/** @class */\nfunction () {\n  function Tracker(touch) {\n    this.velocityMultiplier = /Android/.test(navigator.userAgent) ? window.devicePixelRatio : 1;\n    this.updateTime = Date.now();\n    this.delta = {\n      x: 0,\n      y: 0\n    };\n    this.velocity = {\n      x: 0,\n      y: 0\n    };\n    this.lastPosition = {\n      x: 0,\n      y: 0\n    };\n    this.lastPosition = getPosition(touch);\n  }\n\n  Tracker.prototype.update = function (touch) {\n    var _a = this,\n        velocity = _a.velocity,\n        updateTime = _a.updateTime,\n        lastPosition = _a.lastPosition;\n\n    var now = Date.now();\n    var position = getPosition(touch);\n    var delta = {\n      x: -(position.x - lastPosition.x),\n      y: -(position.y - lastPosition.y)\n    };\n    var duration = now - updateTime || 16.7;\n    var vx = delta.x / duration * 16.7;\n    var vy = delta.y / duration * 16.7;\n    velocity.x = vx * this.velocityMultiplier;\n    velocity.y = vy * this.velocityMultiplier;\n    this.delta = delta;\n    this.updateTime = now;\n    this.lastPosition = position;\n  };\n\n  return Tracker;\n}();\n\nexport { Tracker };\n\nvar TouchRecord =\n/** @class */\nfunction () {\n  function TouchRecord() {\n    this._touchList = {};\n  }\n\n  Object.defineProperty(TouchRecord.prototype, \"_primitiveValue\", {\n    get: function () {\n      return {\n        x: 0,\n        y: 0\n      };\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  TouchRecord.prototype.isActive = function () {\n    return this._activeTouchID !== undefined;\n  };\n\n  TouchRecord.prototype.getDelta = function () {\n    var tracker = this._getActiveTracker();\n\n    if (!tracker) {\n      return this._primitiveValue;\n    }\n\n    return __assign({}, tracker.delta);\n  };\n\n  TouchRecord.prototype.getVelocity = function () {\n    var tracker = this._getActiveTracker();\n\n    if (!tracker) {\n      return this._primitiveValue;\n    }\n\n    return __assign({}, tracker.velocity);\n  };\n\n  TouchRecord.prototype.getEasingDistance = function (damping) {\n    var deAcceleration = 1 - damping;\n    var distance = {\n      x: 0,\n      y: 0\n    };\n    var vel = this.getVelocity();\n    Object.keys(vel).forEach(function (dir) {\n      // ignore small velocity\n      var v = Math.abs(vel[dir]) <= 10 ? 0 : vel[dir];\n\n      while (v !== 0) {\n        distance[dir] += v;\n        v = v * deAcceleration | 0;\n      }\n    });\n    return distance;\n  };\n\n  TouchRecord.prototype.track = function (evt) {\n    var _this = this;\n\n    var targetTouches = evt.targetTouches;\n    Array.from(targetTouches).forEach(function (touch) {\n      _this._add(touch);\n    });\n    return this._touchList;\n  };\n\n  TouchRecord.prototype.update = function (evt) {\n    var _this = this;\n\n    var touches = evt.touches,\n        changedTouches = evt.changedTouches;\n    Array.from(touches).forEach(function (touch) {\n      _this._renew(touch);\n    });\n\n    this._setActiveID(changedTouches);\n\n    return this._touchList;\n  };\n\n  TouchRecord.prototype.release = function (evt) {\n    var _this = this;\n\n    delete this._activeTouchID;\n    Array.from(evt.changedTouches).forEach(function (touch) {\n      _this._delete(touch);\n    });\n  };\n\n  TouchRecord.prototype._add = function (touch) {\n    if (this._has(touch)) {\n      // reset tracker\n      this._delete(touch);\n    }\n\n    var tracker = new Tracker(touch);\n    this._touchList[touch.identifier] = tracker;\n  };\n\n  TouchRecord.prototype._renew = function (touch) {\n    if (!this._has(touch)) {\n      return;\n    }\n\n    var tracker = this._touchList[touch.identifier];\n    tracker.update(touch);\n  };\n\n  TouchRecord.prototype._delete = function (touch) {\n    delete this._touchList[touch.identifier];\n  };\n\n  TouchRecord.prototype._has = function (touch) {\n    return this._touchList.hasOwnProperty(touch.identifier);\n  };\n\n  TouchRecord.prototype._setActiveID = function (touches) {\n    this._activeTouchID = touches[touches.length - 1].identifier;\n  };\n\n  TouchRecord.prototype._getActiveTracker = function () {\n    var _a = this,\n        _touchList = _a._touchList,\n        _activeTouchID = _a._activeTouchID;\n\n    return _touchList[_activeTouchID];\n  };\n\n  return TouchRecord;\n}();\n\nexport { TouchRecord };","map":{"version":3,"mappings":"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","names":["getPosition","touch","test","navigator","userAgent","window","devicePixelRatio","Date","now","x","y","lastPosition","Tracker","velocity","updateTime","position","delta","duration","vx","vy","velocityMultiplier","Object","TouchRecord","_activeTouchID","undefined","tracker","_getActiveTracker","_primitiveValue","damping","deAcceleration","distance","vel","getVelocity","keys","forEach","v","Math","abs","dir","evt","Array","from","targetTouches","_this","_add","_touchList","changedTouches","touches","_renew","_setActiveID","_delete","_has","identifier","update","hasOwnProperty","length"],"sourceRoot":"","sources":["../src/utils/touch-record.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}